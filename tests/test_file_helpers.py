import unittest
import numpy as np
from pathlib import Path

import file_helpers


class TestFileExtraction(unittest.TestCase):
    def setUp(self) -> None:
        self.gpx_file = './test_file.gpx'
        self.fit_file = './test_file.fit'

    def test_gpx_extraction(self):
        lat_lon_data = file_helpers.extract_lat_lon_from_gpx(self.gpx_file)
        way_points = [[50.784026847, 6.090425028],
                      [50.785953252, 6.092227473],
                      [50.787436435, 6.093803895],
                      [50.788670882, 6.095198644],
                      [50.789950730, 6.096404022],
                      [50.790913820, 6.097305244]]
        self.assertListEqual(lat_lon_data, way_points)

    def test_gpx_extraction_file_list(self):
        lat_lon_data = file_helpers.extract_lat_lon_from_file_list([self.gpx_file], Path('.'))
        way_points = np.array([[50.784026847, 6.090425028],
                               [50.785953252, 6.092227473],
                               [50.787436435, 6.093803895],
                               [50.788670882, 6.095198644],
                               [50.789950730, 6.096404022],
                               [50.790913820, 6.097305244]])
        self.assertListEqual(lat_lon_data.tolist(), way_points.tolist())

    def test_fit_extraction(self):
        lat_lon_data = file_helpers.extract_lat_lon_from_fit(self.fit_file)
        way_points = [[50.78402683138847, 6.090424954891205],
                      [50.784267811104655, 6.090650511905551],
                      [50.78450879082084, 6.090875985100865],
                      [50.78474985435605, 6.09110145829618],
                      [50.78499083407223, 6.091326931491494],
                      [50.785231813788414, 6.09155248850584],
                      [50.78547287732363, 6.091777961701155],
                      [50.78571385703981, 6.092003434896469],
                      [50.78595324419439, 6.092227399349213],
                      [50.78620067797601, 6.0924904234707355],
                      [50.786448111757636, 6.0927534475922585],
                      [50.78669554553926, 6.09301638789475],
                      [50.786942979320884, 6.0932794120162725],
                      [50.78719041310251, 6.0935424361377954],
                      [50.78743642196059, 6.093803867697716],
                      [50.78768352046609, 6.09408306889236],
                      [50.78793070279062, 6.094362353906035],
                      [50.78817788511515, 6.094641555100679],
                      [50.788424983620644, 6.094920840114355],
                      [50.788670824840665, 6.09519861638546],
                      [50.78892705962062, 6.095439847558737],
                      [50.78918321058154, 6.095681162551045],
                      [50.789439445361495, 6.095922477543354],
                      [50.78969559632242, 6.096163708716631],
                      [50.78995065763593, 6.096404017880559],
                      [50.79019163735211, 6.096629491075873],
                      [50.79043261706829, 6.096854964271188],
                      [50.79067359678447, 6.097080437466502],
                      [50.79091373831034, 6.097305240109563]]
        self.assertListEqual(lat_lon_data, way_points)

    def test_fit_extraction_file_list(self):
        lat_lon_data = file_helpers.extract_lat_lon_from_file_list([self.fit_file], Path('.'))
        way_points = np.array([[50.78402683138847, 6.090424954891205],
                               [50.784267811104655, 6.090650511905551],
                               [50.78450879082084, 6.090875985100865],
                               [50.78474985435605, 6.09110145829618],
                               [50.78499083407223, 6.091326931491494],
                               [50.785231813788414, 6.09155248850584],
                               [50.78547287732363, 6.091777961701155],
                               [50.78571385703981, 6.092003434896469],
                               [50.78595324419439, 6.092227399349213],
                               [50.78620067797601, 6.0924904234707355],
                               [50.786448111757636, 6.0927534475922585],
                               [50.78669554553926, 6.09301638789475],
                               [50.786942979320884, 6.0932794120162725],
                               [50.78719041310251, 6.0935424361377954],
                               [50.78743642196059, 6.093803867697716],
                               [50.78768352046609, 6.09408306889236],
                               [50.78793070279062, 6.094362353906035],
                               [50.78817788511515, 6.094641555100679],
                               [50.788424983620644, 6.094920840114355],
                               [50.788670824840665, 6.09519861638546],
                               [50.78892705962062, 6.095439847558737],
                               [50.78918321058154, 6.095681162551045],
                               [50.789439445361495, 6.095922477543354],
                               [50.78969559632242, 6.096163708716631],
                               [50.78995065763593, 6.096404017880559],
                               [50.79019163735211, 6.096629491075873],
                               [50.79043261706829, 6.096854964271188],
                               [50.79067359678447, 6.097080437466502],
                               [50.79091373831034, 6.097305240109563]])
        self.assertListEqual(lat_lon_data.tolist(), way_points.tolist())


if __name__ == '__main__':
    unittest.main()
